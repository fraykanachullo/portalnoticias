{% extends "admin/admin_layout.html" %}

{% block admin_content %}

<style>
  /* =============================
     üé® Estilos espec√≠ficos Panel IA
     ============================= */

  /* Contenedor del WordCloud 3D */
  #wc3d-container {
    position: relative;
    height: 320px;
    border-radius: 0.5rem;
    overflow: hidden;
    background: radial-gradient(circle at top, #eef2ff 0, #ffffff 45%, #f9fafb 100%);
  }

  #wc3d-canvas {
    width: 100%;
    height: 100%;
    display: block;
  }

  .wc-toolbar .form-label {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: .05em;
  }

  .wc-toolbar .btn-sm {
    font-size: 0.75rem;
  }

  /* Modo oscuro simple s√≥lo para el panel IA */
  body.ia-dark {
    background-color: #020617;
    color: #e5e7eb;
  }

  body.ia-dark .card {
    background-color: #020617;
    border-color: #111827 !important;
    color: #e5e7eb;
  }

  body.ia-dark .card .text-muted {
    color: #9ca3af !important;
  }

  body.ia-dark #wc3d-container {
    background: radial-gradient(circle at top, #020617 0, #020617 40%, #020617 100%);
  }

  body.ia-dark .btn-outline-secondary {
    color: #e5e7eb;
    border-color: #4b5563;
  }

  body.ia-dark .btn-outline-secondary:hover {
    background-color: #4b5563;
  }

  body.ia-dark .badge.bg-light.text-muted {
    background-color: #1f2937 !important;
    color: #9ca3af !important;
  }
</style>

<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h2 class="mb-1">
      <i class="fa-solid fa-brain"></i> Panel de Inteligencia de Contenido
    </h2>
    <p class="text-muted mb-0" style="font-size: 0.9rem;">
      Monitoriza el sentimiento, las tendencias, las fuentes y las alertas sensibles de las noticias del portal en
      tiempo real.
    </p>
  </div>

  <button id="ia-theme-toggle" class="btn btn-sm btn-outline-secondary">
    <i class="fa-solid fa-moon me-1"></i>
    Modo oscuro
  </button>
</div>

<hr class="mb-4">

<!-- ============================
     PRIMERA FILA: SENTIMIENTO / TOP 10 / WORDCLOUD 3D
     ============================ -->
<div class="row g-4">

  <!-- Sentimiento -->
  <div class="col-lg-4">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-body d-flex flex-column">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h5 class="mb-0">
            <i class="fa-regular fa-face-smile"></i> Sentimiento
          </h5>
          <span class="badge bg-light text-muted" style="font-size: 0.75rem;">
            Recientes
          </span>
        </div>

        <canvas id="sentimentChart"
                data-pos="{{ pos }}"
                data-neg="{{ neg }}"
                data-neu="{{ neu }}"
                height="220"></canvas>

        <div class="mt-3 small">
          <span class="badge bg-success me-1 mb-1">
            Positivas: {{ pos }}
          </span><br>
          <span class="badge bg-danger me-1 mb-1">
            Negativas: {{ neg }}
          </span><br>
          <span class="badge bg-secondary me-1 mb-1">
            Neutras: {{ neu }}
          </span>
        </div>

        <p class="text-muted small mt-2 mb-0">
          Estimaci√≥n sencilla basada en palabras clave de t√≠tulos y descripciones recientes.
        </p>
      </div>
    </div>
  </div>

  <!-- Top 10 -->
  <div class="col-lg-4">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-body d-flex flex-column">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h5 class="mb-0">
            <i class="fa-solid fa-list-ol"></i> Top 10 noticias
          </h5>
          <span class="badge bg-light text-muted" style="font-size: 0.75rem;">
            M√°s recientes
          </span>
        </div>

        <div style="max-height: 320px; overflow-y: auto;">
          {% if top10 %}
          <ol class="list-group list-group-numbered">
            {% for n in top10 %}
            <li class="list-group-item border-0 border-bottom py-2">
              <div class="fw-semibold" style="font-size:0.9rem;">
                {{ n.titulo }}
              </div>
              <div class="small text-muted">
                {{ n.fuente }} ¬∑ {{ n.categoria or 'Sin categor√≠a' }}
              </div>
              {% if n.fecha_publicacion %}
              <div class="small text-muted">
                {{ n.fecha_publicacion }}
              </div>
              {% endif %}
            </li>
            {% endfor %}
          </ol>
          {% else %}
          <p class="text-muted small mb-0">
            No hay suficientes datos para mostrar el ranking.
          </p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- WordCloud 3D PRO -->
<div class="col-lg-4">
  <div class="card shadow-sm border-0 h-100">
    <div class="card-body d-flex flex-column">

      <div class="d-flex justify-content-between align-items-center mb-2">
        <h5 class="mb-0">
          <i class="fa-solid fa-cloud"></i> WordCloud
        </h5>
        <span class="badge bg-light text-muted" style="font-size: 0.75rem;">
          T√©rminos frecuentes
        </span>
      </div>

      <!-- FILTROS -->
      <div class="row g-2 mb-2">
        
        <div class="col-6">
          <label class="small fw-semibold">CATEGOR√çA</label>
          <select id="wc_categoria" class="form-select form-select-sm">
            <option value="">Todas</option>
          </select>
        </div>

        <div class="col-6">
          <label class="small fw-semibold">FUENTE</label>
          <select id="wc_fuente" class="form-select form-select-sm">
            <option value="">Todas</option>
          </select>
        </div>

        <div class="col-6">
          <label class="small fw-semibold">D√çAS</label>
          <input id="wc_dias" type="number" class="form-control form-select-sm" min="1" max="365" value="7">
        </div>

        <div class="col-3 d-flex align-items-end">
          <button id="wc_refresh" class="btn btn-primary btn-sm w-100">
            <i class="fa-solid fa-rotate"></i>
          </button>
        </div>

        <div class="col-3 d-flex align-items-end">
          <button id="wc_download" class="btn btn-success btn-sm w-100">
            <i class="fa-solid fa-download"></i>
          </button>
        </div>

      </div>

      <!-- WordCloud image -->
      <div class="border rounded d-flex align-items-center justify-content-center"
           style="height:320px; overflow:hidden; background:#fafafa;"
           id="wordcloud-box">

        <img id="wordcloud_img" class="img-fluid" src="/api/stats/wordcloud_image" alt="WordCloud">
      </div>

      <p class="mt-2 small text-muted mb-0">
        Nube de palabras generada a partir de los filtros seleccionados.
      </p>

    </div>
  </div>
</div>


</div>

<hr class="my-4">

<!-- ============================
     SEGUNDA FILA: CATEGOR√çAS / FUENTES
     ============================ -->
<div class="row g-4">

  <!-- Categor√≠as -->
  <div class="col-lg-6">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h5 class="mb-0">
            <i class="fa-solid fa-tags"></i> Distribuci√≥n por Categor√≠as
          </h5>
          <span class="badge bg-light text-muted" style="font-size: 0.75rem;">
            Volumen de noticias
          </span>
        </div>
        <p class="text-muted small mb-2">
          Identifica qu√© tipos de noticias predominan en el portal (pol√≠tica, sociedad, econom√≠a, deportes, etc.).
        </p>
        <canvas id="categoriasChart" height="260"></canvas>
      </div>
    </div>
  </div>

  <!-- Fuentes -->
  <div class="col-lg-6">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h5 class="mb-0">
            <i class="fa-solid fa-newspaper"></i> Actividad por Fuente
          </h5>
          <span class="badge bg-light text-muted" style="font-size: 0.75rem;">
            Medios m√°s activos
          </span>
        </div>
        <p class="text-muted small mb-2">
          Muestra qu√© medios o fuentes est√°n aportando m√°s contenido al portal.
        </p>
        <canvas id="fuentesChart" height="260"></canvas>
      </div>
    </div>
  </div>

</div>

<hr class="my-4">

<!-- ============================
     TERCERA FILA: ALERTAS IA
     ============================ -->
<div class="row g-4">
  <div class="col-12">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h5 class="mb-0">
            <i class="fa-solid fa-triangle-exclamation text-danger"></i>
            Alertas IA (contenido sensible)
          </h5>
          <span class="badge bg-light text-muted" style="font-size: 0.75rem;">
            Detecci√≥n temprana
          </span>
        </div>

        <p class="small text-muted mb-3">
          Noticias recientes que contienen palabras clave asociadas a riesgo: crimen, tragedias, violencia,
          corrupci√≥n, desastres, etc. √ötil para monitorear contenido sensible o de alto impacto.
        </p>

        <div id="alertas-ia-list" style="max-height: 260px; overflow-y: auto;">
          <!-- JS llenar√° aqu√≠ las alertas -->
          <p class="text-muted small mb-0">Cargando alertas IA...</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- SCRIPTS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Three.js para WordCloud 3D -->
<script src="https://unpkg.com/three@0.161.0/build/three.min.js"></script>
<script src="/static/js/admin_ia.js"></script>

{% endblock %}
