{% extends "admin/admin_layout.html" %}

{% block admin_content %}

<h2 class="mb-3">
  <i class="fa-solid fa-newspaper"></i> Gesti√≥n de noticias
</h2>

<!-- üîç FILTROS -->
<div class="d-flex justify-content-between align-items-center mb-3">

  <form class="row g-2" method="get" action="{{ url_for('admin.admin_noticias') }}">

    <div class="col-md-3">
      <input type="text" name="q" class="form-control form-control-sm"
             placeholder="Buscar por t√≠tulo..."
             value="{{ q or '' }}">
    </div>

    <div class="col-md-3">
      <select name="fuente" class="form-select form-select-sm">
        <option value="">Todas las fuentes</option>
        {% for f in fuentes %}
          <option value="{{ f.id }}" {% if fuente_sel == f.id|string %}selected{% endif %}>
            {{ f.nombre }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-3">
      <select name="categoria" class="form-select form-select-sm">
        <option value="">Todas las categor√≠as</option>
        {% for c in categorias %}
          <option value="{{ c }}" {% if categoria_sel == c %}selected{% endif %}>
            {{ c }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-2 d-grid">
      <button class="btn btn-sm btn-dark" type="submit">
        <i class="fa-solid fa-magnifying-glass"></i> Filtrar
      </button>
    </div>
  </form>

  <!-- ‚ûï NUEVA NOTICIA -->
  <a href="{{ url_for('admin.admin_noticia_nueva') }}"
     class="btn btn-sm btn-danger ms-2">
    <i class="fa-solid fa-plus"></i> Nueva noticia
  </a>
</div>

<!-- üîé Buscador instant√°neo en la tabla -->
<div class="mb-3">
  <input type="text" id="searchTableInstant"
         class="form-control form-control-sm"
         placeholder="Filtrar dentro de la tabla (instant√°neo)‚Ä¶">
</div>

<!-- üìÑ TABLA -->
<div class="card shadow-sm border-0">
  <div class="card-body p-0">
    <table class="table table-striped table-hover mb-0 align-middle" id="tablaNoticias">
      <thead class="table-dark">
        <tr>
          <th>T√≠tulo</th>
          <th>Fuente</th>
          <th>Categor√≠a</th>
          <th>Fecha</th>
          <th class="text-end">Acciones</th>
        </tr>
      </thead>

      <tbody>
        {% if noticias %}
          {% for n in noticias %}
          <tr>
            <td style="max-width:300px;">
              {{ n.titulo[:80] }}{% if n.titulo|length > 80 %}...{% endif %}
            </td>
            <td>{{ n.fuente }}</td>
            <td>{{ n.categoria }}</td>
            <td>{{ n.fecha }}</td>

            <td class="text-end">

              <!-- ‚úè EDITAR -->
              <a href="{{ url_for('admin.admin_noticia_editar', noticia_id=n.id) }}"
                 class="btn btn-sm btn-warning">
                <i class="fa-solid fa-pen"></i>
              </a>

              <!-- üóë ELIMINAR -->
              <form method="post"
                    action="{{ url_for('admin.admin_noticia_eliminar', noticia_id=n.id) }}"
                    style="display:inline-block"
                    onsubmit="return confirm('¬øEliminar esta noticia?');">
                <button class="btn btn-sm btn-outline-danger">
                  <i class="fa-solid fa-trash"></i>
                </button>
              </form>

            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="5" class="text-center text-muted py-4">
              No se encontraron noticias con esos filtros.
            </td>
          </tr>
        {% endif %}
      </tbody>

    </table>
  </div>
</div>

<!-- üîç Buscador instant√°neo -->
<script>
document.addEventListener("DOMContentLoaded", () => {
    const input = document.getElementById("searchTableInstant");
    const rows = document.querySelectorAll("#tablaNoticias tbody tr");
    if (!input || !rows.length) return;

    input.addEventListener("keyup", () => {
      const q = input.value.toLowerCase();
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(q) ? "" : "none";
      });
    });
});
</script>

{% endblock %}
